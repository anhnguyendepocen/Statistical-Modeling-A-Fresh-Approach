<!DOCTYPE html>
<!-- saved from url=(0014)about:internet -->
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>

<title>Monday April 8, 2013 Stats 155 Class Notes </title>

<style type="text/css">
body, td {
   font-family: sans-serif;
   background-color: white;
   font-size: 12px;
   margin: 8px;
}

tt, code, pre {
   font-family: 'DejaVu Sans Mono', 'Droid Sans Mono', 'Lucida Console', Consolas, Monaco, monospace;
}

h1 { 
   font-size:2.2em; 
}

h2 { 
   font-size:1.8em; 
}

h3 { 
   font-size:1.4em; 
}

h4 { 
   font-size:1.0em; 
}

h5 { 
   font-size:0.9em; 
}

h6 { 
   font-size:0.8em; 
}

a:visited {
   color: rgb(50%, 0%, 50%);
}

pre {	
   margin-top: 0;
   max-width: 95%;
   border: 1px solid #ccc;
   white-space: pre-wrap;
}

pre code {
   display: block; padding: 0.5em;
}

code.r, code.cpp {
   background-color: #F8F8F8;
}

table, td, th {
  border: none;
}

blockquote {
   color:#666666;
   margin:0;
   padding-left: 1em;
   border-left: 0.5em #EEE solid;
}

hr {
   height: 0px;
   border-bottom: none;
   border-top-width: thin;
   border-top-style: dotted;
   border-top-color: #999999;
}

@media print {
   * { 
      background: transparent !important; 
      color: black !important; 
      filter:none !important; 
      -ms-filter: none !important; 
   }

   body { 
      font-size:12pt; 
      max-width:100%; 
   }
       
   a, a:visited { 
      text-decoration: underline; 
   }

   hr { 
      visibility: hidden;
      page-break-before: always;
   }

   pre, blockquote { 
      padding-right: 1em; 
      page-break-inside: avoid; 
   }

   tr, img { 
      page-break-inside: avoid; 
   }

   img { 
      max-width: 100% !important; 
   }

   @page :left { 
      margin: 15mm 20mm 15mm 10mm; 
   }
     
   @page :right { 
      margin: 15mm 10mm 15mm 20mm; 
   }

   p, h2, h3 { 
      orphans: 3; widows: 3; 
   }

   h2, h3 { 
      page-break-after: avoid; 
   }
}

</style>

<!-- Styles for R syntax highlighter -->
<style type="text/css">
   pre .operator,
   pre .paren {
     color: rgb(104, 118, 135)
   }

   pre .literal {
     color: rgb(88, 72, 246)
   }

   pre .number {
     color: rgb(0, 0, 205);
   }

   pre .comment {
     color: rgb(76, 136, 107);
   }

   pre .keyword {
     color: rgb(0, 0, 255);
   }

   pre .identifier {
     color: rgb(0, 0, 0);
   }

   pre .string {
     color: rgb(3, 106, 7);
   }
</style>

<!-- R syntax highlighter -->
<script type="text/javascript">
var hljs=new function(){function m(p){return p.replace(/&/gm,"&amp;").replace(/</gm,"&lt;")}function f(r,q,p){return RegExp(q,"m"+(r.cI?"i":"")+(p?"g":""))}function b(r){for(var p=0;p<r.childNodes.length;p++){var q=r.childNodes[p];if(q.nodeName=="CODE"){return q}if(!(q.nodeType==3&&q.nodeValue.match(/\s+/))){break}}}function h(t,s){var p="";for(var r=0;r<t.childNodes.length;r++){if(t.childNodes[r].nodeType==3){var q=t.childNodes[r].nodeValue;if(s){q=q.replace(/\n/g,"")}p+=q}else{if(t.childNodes[r].nodeName=="BR"){p+="\n"}else{p+=h(t.childNodes[r])}}}if(/MSIE [678]/.test(navigator.userAgent)){p=p.replace(/\r/g,"\n")}return p}function a(s){var r=s.className.split(/\s+/);r=r.concat(s.parentNode.className.split(/\s+/));for(var q=0;q<r.length;q++){var p=r[q].replace(/^language-/,"");if(e[p]){return p}}}function c(q){var p=[];(function(s,t){for(var r=0;r<s.childNodes.length;r++){if(s.childNodes[r].nodeType==3){t+=s.childNodes[r].nodeValue.length}else{if(s.childNodes[r].nodeName=="BR"){t+=1}else{if(s.childNodes[r].nodeType==1){p.push({event:"start",offset:t,node:s.childNodes[r]});t=arguments.callee(s.childNodes[r],t);p.push({event:"stop",offset:t,node:s.childNodes[r]})}}}}return t})(q,0);return p}function k(y,w,x){var q=0;var z="";var s=[];function u(){if(y.length&&w.length){if(y[0].offset!=w[0].offset){return(y[0].offset<w[0].offset)?y:w}else{return w[0].event=="start"?y:w}}else{return y.length?y:w}}function t(D){var A="<"+D.nodeName.toLowerCase();for(var B=0;B<D.attributes.length;B++){var C=D.attributes[B];A+=" "+C.nodeName.toLowerCase();if(C.value!==undefined&&C.value!==false&&C.value!==null){A+='="'+m(C.value)+'"'}}return A+">"}while(y.length||w.length){var v=u().splice(0,1)[0];z+=m(x.substr(q,v.offset-q));q=v.offset;if(v.event=="start"){z+=t(v.node);s.push(v.node)}else{if(v.event=="stop"){var p,r=s.length;do{r--;p=s[r];z+=("</"+p.nodeName.toLowerCase()+">")}while(p!=v.node);s.splice(r,1);while(r<s.length){z+=t(s[r]);r++}}}}return z+m(x.substr(q))}function j(){function q(x,y,v){if(x.compiled){return}var u;var s=[];if(x.k){x.lR=f(y,x.l||hljs.IR,true);for(var w in x.k){if(!x.k.hasOwnProperty(w)){continue}if(x.k[w] instanceof Object){u=x.k[w]}else{u=x.k;w="keyword"}for(var r in u){if(!u.hasOwnProperty(r)){continue}x.k[r]=[w,u[r]];s.push(r)}}}if(!v){if(x.bWK){x.b="\\b("+s.join("|")+")\\s"}x.bR=f(y,x.b?x.b:"\\B|\\b");if(!x.e&&!x.eW){x.e="\\B|\\b"}if(x.e){x.eR=f(y,x.e)}}if(x.i){x.iR=f(y,x.i)}if(x.r===undefined){x.r=1}if(!x.c){x.c=[]}x.compiled=true;for(var t=0;t<x.c.length;t++){if(x.c[t]=="self"){x.c[t]=x}q(x.c[t],y,false)}if(x.starts){q(x.starts,y,false)}}for(var p in e){if(!e.hasOwnProperty(p)){continue}q(e[p].dM,e[p],true)}}function d(B,C){if(!j.called){j();j.called=true}function q(r,M){for(var L=0;L<M.c.length;L++){if((M.c[L].bR.exec(r)||[null])[0]==r){return M.c[L]}}}function v(L,r){if(D[L].e&&D[L].eR.test(r)){return 1}if(D[L].eW){var M=v(L-1,r);return M?M+1:0}return 0}function w(r,L){return L.i&&L.iR.test(r)}function K(N,O){var M=[];for(var L=0;L<N.c.length;L++){M.push(N.c[L].b)}var r=D.length-1;do{if(D[r].e){M.push(D[r].e)}r--}while(D[r+1].eW);if(N.i){M.push(N.i)}return f(O,M.join("|"),true)}function p(M,L){var N=D[D.length-1];if(!N.t){N.t=K(N,E)}N.t.lastIndex=L;var r=N.t.exec(M);return r?[M.substr(L,r.index-L),r[0],false]:[M.substr(L),"",true]}function z(N,r){var L=E.cI?r[0].toLowerCase():r[0];var M=N.k[L];if(M&&M instanceof Array){return M}return false}function F(L,P){L=m(L);if(!P.k){return L}var r="";var O=0;P.lR.lastIndex=0;var M=P.lR.exec(L);while(M){r+=L.substr(O,M.index-O);var N=z(P,M);if(N){x+=N[1];r+='<span class="'+N[0]+'">'+M[0]+"</span>"}else{r+=M[0]}O=P.lR.lastIndex;M=P.lR.exec(L)}return r+L.substr(O,L.length-O)}function J(L,M){if(M.sL&&e[M.sL]){var r=d(M.sL,L);x+=r.keyword_count;return r.value}else{return F(L,M)}}function I(M,r){var L=M.cN?'<span class="'+M.cN+'">':"";if(M.rB){y+=L;M.buffer=""}else{if(M.eB){y+=m(r)+L;M.buffer=""}else{y+=L;M.buffer=r}}D.push(M);A+=M.r}function G(N,M,Q){var R=D[D.length-1];if(Q){y+=J(R.buffer+N,R);return false}var P=q(M,R);if(P){y+=J(R.buffer+N,R);I(P,M);return P.rB}var L=v(D.length-1,M);if(L){var O=R.cN?"</span>":"";if(R.rE){y+=J(R.buffer+N,R)+O}else{if(R.eE){y+=J(R.buffer+N,R)+O+m(M)}else{y+=J(R.buffer+N+M,R)+O}}while(L>1){O=D[D.length-2].cN?"</span>":"";y+=O;L--;D.length--}var r=D[D.length-1];D.length--;D[D.length-1].buffer="";if(r.starts){I(r.starts,"")}return R.rE}if(w(M,R)){throw"Illegal"}}var E=e[B];var D=[E.dM];var A=0;var x=0;var y="";try{var s,u=0;E.dM.buffer="";do{s=p(C,u);var t=G(s[0],s[1],s[2]);u+=s[0].length;if(!t){u+=s[1].length}}while(!s[2]);if(D.length>1){throw"Illegal"}return{r:A,keyword_count:x,value:y}}catch(H){if(H=="Illegal"){return{r:0,keyword_count:0,value:m(C)}}else{throw H}}}function g(t){var p={keyword_count:0,r:0,value:m(t)};var r=p;for(var q in e){if(!e.hasOwnProperty(q)){continue}var s=d(q,t);s.language=q;if(s.keyword_count+s.r>r.keyword_count+r.r){r=s}if(s.keyword_count+s.r>p.keyword_count+p.r){r=p;p=s}}if(r.language){p.second_best=r}return p}function i(r,q,p){if(q){r=r.replace(/^((<[^>]+>|\t)+)/gm,function(t,w,v,u){return w.replace(/\t/g,q)})}if(p){r=r.replace(/\n/g,"<br>")}return r}function n(t,w,r){var x=h(t,r);var v=a(t);var y,s;if(v){y=d(v,x)}else{return}var q=c(t);if(q.length){s=document.createElement("pre");s.innerHTML=y.value;y.value=k(q,c(s),x)}y.value=i(y.value,w,r);var u=t.className;if(!u.match("(\\s|^)(language-)?"+v+"(\\s|$)")){u=u?(u+" "+v):v}if(/MSIE [678]/.test(navigator.userAgent)&&t.tagName=="CODE"&&t.parentNode.tagName=="PRE"){s=t.parentNode;var p=document.createElement("div");p.innerHTML="<pre><code>"+y.value+"</code></pre>";t=p.firstChild.firstChild;p.firstChild.cN=s.cN;s.parentNode.replaceChild(p.firstChild,s)}else{t.innerHTML=y.value}t.className=u;t.result={language:v,kw:y.keyword_count,re:y.r};if(y.second_best){t.second_best={language:y.second_best.language,kw:y.second_best.keyword_count,re:y.second_best.r}}}function o(){if(o.called){return}o.called=true;var r=document.getElementsByTagName("pre");for(var p=0;p<r.length;p++){var q=b(r[p]);if(q){n(q,hljs.tabReplace)}}}function l(){if(window.addEventListener){window.addEventListener("DOMContentLoaded",o,false);window.addEventListener("load",o,false)}else{if(window.attachEvent){window.attachEvent("onload",o)}else{window.onload=o}}}var e={};this.LANGUAGES=e;this.highlight=d;this.highlightAuto=g;this.fixMarkup=i;this.highlightBlock=n;this.initHighlighting=o;this.initHighlightingOnLoad=l;this.IR="[a-zA-Z][a-zA-Z0-9_]*";this.UIR="[a-zA-Z_][a-zA-Z0-9_]*";this.NR="\\b\\d+(\\.\\d+)?";this.CNR="\\b(0[xX][a-fA-F0-9]+|(\\d+(\\.\\d*)?|\\.\\d+)([eE][-+]?\\d+)?)";this.BNR="\\b(0b[01]+)";this.RSR="!|!=|!==|%|%=|&|&&|&=|\\*|\\*=|\\+|\\+=|,|\\.|-|-=|/|/=|:|;|<|<<|<<=|<=|=|==|===|>|>=|>>|>>=|>>>|>>>=|\\?|\\[|\\{|\\(|\\^|\\^=|\\||\\|=|\\|\\||~";this.ER="(?![\\s\\S])";this.BE={b:"\\\\.",r:0};this.ASM={cN:"string",b:"'",e:"'",i:"\\n",c:[this.BE],r:0};this.QSM={cN:"string",b:'"',e:'"',i:"\\n",c:[this.BE],r:0};this.CLCM={cN:"comment",b:"//",e:"$"};this.CBLCLM={cN:"comment",b:"/\\*",e:"\\*/"};this.HCM={cN:"comment",b:"#",e:"$"};this.NM={cN:"number",b:this.NR,r:0};this.CNM={cN:"number",b:this.CNR,r:0};this.BNM={cN:"number",b:this.BNR,r:0};this.inherit=function(r,s){var p={};for(var q in r){p[q]=r[q]}if(s){for(var q in s){p[q]=s[q]}}return p}}();hljs.LANGUAGES.cpp=function(){var a={keyword:{"false":1,"int":1,"float":1,"while":1,"private":1,"char":1,"catch":1,"export":1,virtual:1,operator:2,sizeof:2,dynamic_cast:2,typedef:2,const_cast:2,"const":1,struct:1,"for":1,static_cast:2,union:1,namespace:1,unsigned:1,"long":1,"throw":1,"volatile":2,"static":1,"protected":1,bool:1,template:1,mutable:1,"if":1,"public":1,friend:2,"do":1,"return":1,"goto":1,auto:1,"void":2,"enum":1,"else":1,"break":1,"new":1,extern:1,using:1,"true":1,"class":1,asm:1,"case":1,typeid:1,"short":1,reinterpret_cast:2,"default":1,"double":1,register:1,explicit:1,signed:1,typename:1,"try":1,"this":1,"switch":1,"continue":1,wchar_t:1,inline:1,"delete":1,alignof:1,char16_t:1,char32_t:1,constexpr:1,decltype:1,noexcept:1,nullptr:1,static_assert:1,thread_local:1,restrict:1,_Bool:1,complex:1},built_in:{std:1,string:1,cin:1,cout:1,cerr:1,clog:1,stringstream:1,istringstream:1,ostringstream:1,auto_ptr:1,deque:1,list:1,queue:1,stack:1,vector:1,map:1,set:1,bitset:1,multiset:1,multimap:1,unordered_set:1,unordered_map:1,unordered_multiset:1,unordered_multimap:1,array:1,shared_ptr:1}};return{dM:{k:a,i:"</",c:[hljs.CLCM,hljs.CBLCLM,hljs.QSM,{cN:"string",b:"'\\\\?.",e:"'",i:"."},{cN:"number",b:"\\b(\\d+(\\.\\d*)?|\\.\\d+)(u|U|l|L|ul|UL|f|F)"},hljs.CNM,{cN:"preprocessor",b:"#",e:"$"},{cN:"stl_container",b:"\\b(deque|list|queue|stack|vector|map|set|bitset|multiset|multimap|unordered_map|unordered_set|unordered_multiset|unordered_multimap|array)\\s*<",e:">",k:a,r:10,c:["self"]}]}}}();hljs.LANGUAGES.r={dM:{c:[hljs.HCM,{cN:"number",b:"\\b0[xX][0-9a-fA-F]+[Li]?\\b",e:hljs.IMMEDIATE_RE,r:0},{cN:"number",b:"\\b\\d+(?:[eE][+\\-]?\\d*)?L\\b",e:hljs.IMMEDIATE_RE,r:0},{cN:"number",b:"\\b\\d+\\.(?!\\d)(?:i\\b)?",e:hljs.IMMEDIATE_RE,r:1},{cN:"number",b:"\\b\\d+(?:\\.\\d*)?(?:[eE][+\\-]?\\d*)?i?\\b",e:hljs.IMMEDIATE_RE,r:0},{cN:"number",b:"\\.\\d+(?:[eE][+\\-]?\\d*)?i?\\b",e:hljs.IMMEDIATE_RE,r:1},{cN:"keyword",b:"(?:tryCatch|library|setGeneric|setGroupGeneric)\\b",e:hljs.IMMEDIATE_RE,r:10},{cN:"keyword",b:"\\.\\.\\.",e:hljs.IMMEDIATE_RE,r:10},{cN:"keyword",b:"\\.\\.\\d+(?![\\w.])",e:hljs.IMMEDIATE_RE,r:10},{cN:"keyword",b:"\\b(?:function)",e:hljs.IMMEDIATE_RE,r:2},{cN:"keyword",b:"(?:if|in|break|next|repeat|else|for|return|switch|while|try|stop|warning|require|attach|detach|source|setMethod|setClass)\\b",e:hljs.IMMEDIATE_RE,r:1},{cN:"literal",b:"(?:NA|NA_integer_|NA_real_|NA_character_|NA_complex_)\\b",e:hljs.IMMEDIATE_RE,r:10},{cN:"literal",b:"(?:NULL|TRUE|FALSE|T|F|Inf|NaN)\\b",e:hljs.IMMEDIATE_RE,r:1},{cN:"identifier",b:"[a-zA-Z.][a-zA-Z0-9._]*\\b",e:hljs.IMMEDIATE_RE,r:0},{cN:"operator",b:"<\\-(?!\\s*\\d)",e:hljs.IMMEDIATE_RE,r:2},{cN:"operator",b:"\\->|<\\-",e:hljs.IMMEDIATE_RE,r:1},{cN:"operator",b:"%%|~",e:hljs.IMMEDIATE_RE},{cN:"operator",b:">=|<=|==|!=|\\|\\||&&|=|\\+|\\-|\\*|/|\\^|>|<|!|&|\\||\\$|:",e:hljs.IMMEDIATE_RE,r:0},{cN:"operator",b:"%",e:"%",i:"\\n",r:1},{cN:"identifier",b:"`",e:"`",r:0},{cN:"string",b:'"',e:'"',c:[hljs.BE],r:0},{cN:"string",b:"'",e:"'",c:[hljs.BE],r:0},{cN:"paren",b:"[[({\\])}]",e:hljs.IMMEDIATE_RE,r:0}]}};
hljs.initHighlightingOnLoad();
</script>


<!-- MathJax scripts -->
<script type="text/javascript" src="https://c328740.ssl.cf1.rackcdn.com/mathjax/2.0-latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>



</head>

<body>
<h1>Monday April 8, 2013 Stats 155 Class Notes </h1>

<h2>Overview</h2>

<h4>An Example</h4>

<p>An article about organic food diet and health of young children in the <a href="https://dl.dropbox.com/u/5098197/ISM/OrganicFoods-14519.pdf">British Journal of Nutrition</a>.</p>

<p>Table 3 shows odds ratios for five different foods for both moderately organic and strictly organic diets.  10 comparisons, one of which is significant at \( p=0.02 \).  Doing a Bonferroni adjustment suggests an appropriate threshold is 0.005.</p>

<h3>Interpreting p-values</h3>

<h3>Activity</h3>

<p>Print out <a href="../Epidemiology/Notes/Activities/conf-interval-tables.pdf">list of 20 p-values</a>. Ask who has got the first one &lt; 0.05? Who has got any of them? What&#39;s the smallest p-value in the class?</p>

<p>Simulation activity:</p>

<pre><code class="r">fetchData(&quot;simulate.r&quot;)
</code></pre>

<pre><code>## Retrieving from http://www.mosaic-web.org/go/datasets/simulate.r
</code></pre>

<pre><code>## [1] TRUE
</code></pre>

<pre><code class="r">d = run.sim(bogus.groups, ngroups = 5, 10)
mean(val ~ group, data = d)
</code></pre>

<pre><code>##      A      B      C      D      E 
## 101.12 103.13  93.63 104.83  99.87
</code></pre>

<pre><code class="r">dd = subset(d, group %in% c(&quot;D&quot;, &quot;C&quot;), drop = TRUE)  # or whatever are the furthest-apart groups
summary(lm(val ~ group, data = dd))
</code></pre>

<pre><code>## 
## Call:
## lm(formula = val ~ group, data = dd)
## 
## Residuals:
##    Min     1Q Median     3Q    Max 
## -18.93  -9.30  -0.72   7.71  25.18 
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)    93.63       3.59   26.09  9.4e-16 ***
## groupD         11.20       5.07    2.21    0.041 *  
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1 
## 
## Residual standard error: 11.3 on 18 degrees of freedom
## Multiple R-squared: 0.213,   Adjusted R-squared: 0.169 
## F-statistic: 4.87 on 1 and 18 DF,  p-value: 0.0405
</code></pre>

<p>Carry out a hypothesis test on a subset that is just the best and worst groups. How often do people get a p-value less than 0.05?</p>

<p>Problem 14.04.</p>

<p>Publication bias.  Filing cabinet problem.</p>

<h3>mLM and reading R<sup>2</sup> as more terms change</h3>

<p>Show how terms increase R<sup>2,</sup> which gives the fraction of distance to the response variable.</p>

<p>Introduce the idea of the log to handle the interaction between sector and sex, why the dollar amount of difference between the sectors should differ between the sexes.</p>

<h3>The Structure of the ANOVA table</h3>

<p>Starting model: <code>A ~1</code></p>

<p>The basic information on each additional term:</p>

<ul>
<li>Increment in the sum of squares of response (difference from last model)</li>
<li>Degrees of freedom (increase in number of non-redundant coefficients)</li>
</ul>

<p>Final model: <code>A ~ ... + rand(big)</code></p>

<h3>Two categorical variables</h3>

<p>Example: Sector and sex</p>

<pre><code class="r">mod = lm(wage ~ sector * sex, data = CPS85)
anova(mod)
</code></pre>

<pre><code>## Analysis of Variance Table
## 
## Response: wage
##             Df Sum Sq Mean Sq F value  Pr(&gt;F)    
## sector       7   2572     367   17.50 &lt; 2e-16 ***
## sex          1    436     436   20.77 6.5e-06 ***
## sector:sex   6    175      29    1.39    0.22    
## Residuals  519  10894      21                    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
</code></pre>

<p>Have we detected an interaction?</p>

<h4>ACTIVITY</h4>

<p>Create the set of nested models and construct the ANOVA table by hand.</p>

<h4>Digression: Log prices and wages</h4>

<p>Prices are relative.  An indication of this is the almost universal use of percentages to describe inflation, wage increases, etc.  For example, an often quoted number is that women earn approximately 72 cents for each dollar earned by a man.  </p>

<p>The naive way to find this number, which is in fact the way it is found, is to divide the average wage of women by the average wage of men, e.g.</p>

<pre><code class="r">mean(wage ~ sex, data = CPS85)
</code></pre>

<pre><code>##     F     M 
## 7.879 9.995
</code></pre>

<pre><code class="r">7.88/9.99
</code></pre>

<pre><code>## [1] 0.7888
</code></pre>

<p>Close to the quoted number in this data set from the 1980s.</p>

<p>A better way is to work with log wages, find the contribution from sex, and then convert that back into a multiplier.  That let&#39;s us adjust for various other factors.  Here&#39;s the basic calculation, done in log-wage style:</p>

<pre><code class="r">lm(log(wage) ~ sex, data = CPS85)
</code></pre>

<pre><code>## 
## Call:
## lm(formula = log(wage) ~ sex, data = CPS85)
## 
## Coefficients:
## (Intercept)         sexM  
##       1.934        0.231
</code></pre>

<pre><code class="r">exp(-0.2312)
</code></pre>

<pre><code>## [1] 0.7936
</code></pre>

<p>Now we can include covariates:</p>

<pre><code class="r">lm(log(wage) ~ sex + sector + exper + educ, data = CPS85)
</code></pre>

<pre><code>## 
## Call:
## lm(formula = log(wage) ~ sex + sector + exper + educ, data = CPS85)
## 
## Coefficients:
##   (Intercept)           sexM    sectorconst    sectormanag    sectormanuf  
##        0.6978         0.2197         0.1637         0.2087         0.0447  
##   sectorother     sectorprof    sectorsales  sectorservice          exper  
##        0.0393         0.1976        -0.1513        -0.1539         0.0118  
##          educ  
##        0.0761
</code></pre>

<pre><code class="r">exp(-0.2197)
</code></pre>

<pre><code>## [1] 0.8028
</code></pre>

<p>Hardly any difference.  But maybe the model should be more complicated. </p>

<h4>Activity</h4>

<p>Use ANOVA and log wages to see if interactions should be included in the model.  Example:</p>

<pre><code class="r">mod = lm(log(wage) ~ sector * sex, data = CPS85)
anova(mod)
</code></pre>

<pre><code>## Analysis of Variance Table
## 
## Response: log(wage)
##             Df Sum Sq Mean Sq F value  Pr(&gt;F)    
## sector       7   27.0    3.86   17.78 &lt; 2e-16 ***
## sex          1    5.4    5.44   25.06 7.6e-07 ***
## sector:sex   6    3.2    0.53    2.46   0.024 *  
## Residuals  519  112.8    0.22                    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
</code></pre>

<h4>Student Activity</h4>

<p>Question: Is there an interaction between age and mileage in the used car data?  Does it show up if we look at log prices?</p>

<pre><code class="r">cars = fetchData(&quot;used-hondas.csv&quot;)
</code></pre>

<pre><code>## Retrieving from http://www.mosaic-web.org/go/datasets/used-hondas.csv
</code></pre>

<pre><code class="r">anova(lm(log(Price) ~ Age * Mileage, data = cars))
</code></pre>

<pre><code>## Analysis of Variance Table
## 
## Response: log(Price)
##             Df Sum Sq Mean Sq F value Pr(&gt;F)    
## Age          1   8.33    8.33  599.43 &lt;2e-16 ***
## Mileage      1   2.19    2.19  157.41 &lt;2e-16 ***
## Age:Mileage  1   0.05    0.05    3.29  0.073 .  
## Residuals   88   1.22    0.01                   
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
</code></pre>

<h3>Example: Do professors vary in how they grade? Revisited</h3>

<p>One place where F shines is when we want to look at many explanatory vectors collectively.</p>

<p>In the last class, we looked at professor-wise gradepoint averages, with an eye to the question of whether some professors are easy grading.  We used as a test statistic, the model coefficient for each professor, and ran into the question of multiple comparisons.  </p>

<p>Now let&#39;s return to the question using analysis of variance.</p>

<pre><code class="r">grades = fetchData(&quot;grades.csv&quot;)
</code></pre>

<pre><code>## Retrieving from http://www.mosaic-web.org/go/datasets/grades.csv
</code></pre>

<pre><code class="r">courses = fetchData(&quot;courses.csv&quot;)
</code></pre>

<pre><code>## Retrieving from http://www.mosaic-web.org/go/datasets/courses.csv
</code></pre>

<pre><code class="r">g2n = fetchData(&quot;grade-to-number.csv&quot;)
</code></pre>

<pre><code>## Retrieving from http://www.mosaic-web.org/go/datasets/grade-to-number.csv
</code></pre>

<pre><code class="r">all = merge(grades, courses)
all = merge(all, g2n)  # a data set of every grade given, etc.
</code></pre>

<p>Suppose, instead of being concerned about individual professors, we were interested in the professorate as a whole: do they grade in a consistent way, where &ldquo;consistent&rdquo; means, &ldquo;draw grades from a common pool.&rdquo;  This test can be done easily.  Build the model and see if the explanatory variable accounts for more than is likely to arise from chance:</p>

<pre><code class="r">mod1 = lm(gradepoint ~ iid, data = all)
r.squared(mod1)
</code></pre>

<pre><code>## [1] 0.1745
</code></pre>

<p>The regression report actually gives a p-value for this r.squared.  It&#39;s not any different than we would get by travelling to Planet Null:  randomizing <code>iid</code> and seeing what is the distribution of R<sup>2</sup> on Planet Null.</p>

<p>Another way to summarize the model is with an ANOVA report:</p>

<pre><code class="r">anova(mod1)
</code></pre>

<pre><code>## Analysis of Variance Table
## 
## Response: gradepoint
##             Df Sum Sq Mean Sq F value Pr(&gt;F)    
## iid        358    352   0.983    3.16 &lt;2e-16 ***
## Residuals 5350   1665   0.311                   
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
</code></pre>

<h3>Theory of F</h3>

<p>Explain R<sup>2</sup> in terms of the graph of (hypothetical) R<sup>2</sup> versus number of junky model vectors.  F is the ratio of segment slopes</p>

<p>Now do it stepwise by finding the sum of squares of the fitted model values in a set of models <code>~1</code> and <code>~1 + iid</code></p>

<ul>
<li>Sum of squares of the fitted model values</li>
<li>DF (&ldquo;degrees of freedom&rdquo;) a count of coefficients</li>
<li>Residual SS &mdash; sum of squares of the residuals</li>
<li>Residual DF &mdash; \( n \) - DF of the model</li>
<li>Look at how things change when going from <code>~1</code> to <code>~1 +iid</code>.</li>
<li>&ldquo;Mean square&rdquo; is SS/DF</li>
</ul>

<p>A way to think of the F statistic: miles per gallon for the model terms compared to miles per gallon for the </p>

<h3>Breaking up the Variance into Parts</h3>

<p>Of course, it&#39;s not fair to credit professors for variation in grades that is really due to the students.  So we want to divide up the variation into that due to the students and that due to the professors.  ANOVA let&#39;s you do this:</p>

<pre><code class="r">mod2 = lm(gradepoint ~ sid + iid, data = all)
anova(mod2)
</code></pre>

<pre><code>## Analysis of Variance Table
## 
## Response: gradepoint
##             Df Sum Sq Mean Sq F value Pr(&gt;F)    
## sid        442    645   1.459    6.76 &lt;2e-16 ***
## iid        358    313   0.873    4.04 &lt;2e-16 ***
## Residuals 4908   1060   0.216                   
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
</code></pre>

<p>Interestingly, the result depends on the order in which you put the model terms, even though the model values do not at all depend on this.</p>

<pre><code class="r">mod3 = lm(gradepoint ~ iid + sid, data = all)
anova(mod3)
</code></pre>

<pre><code>## Analysis of Variance Table
## 
## Response: gradepoint
##             Df Sum Sq Mean Sq F value Pr(&gt;F)    
## iid        358    352   0.983    4.55 &lt;2e-16 ***
## sid        442    606   1.370    6.34 &lt;2e-16 ***
## Residuals 4908   1060   0.216                   
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
</code></pre>

<pre><code class="r">sum((fitted(mod2) - fitted(mod3))^2)  # model values are the same
</code></pre>

<pre><code>## [1] 1.039e-22
</code></pre>

<h2>Eating Up the Variance</h2>

<p>The F statistic compares the &ldquo;credit&rdquo; earned by a model term to the mean square residual, which can be interpreted as the credit that would be earned by a junky random term.</p>

<p>Fit a model and add in some random terms.  Show that the F for the random terms is about 1 and that the mean square of the residual is hardly changed by the random terms.</p>

<pre><code class="r">mod0 = lm(wage ~ sector + sex + exper, data = CPS85)
anova(mod0)
</code></pre>

<pre><code>## Analysis of Variance Table
## 
## Response: wage
##            Df Sum Sq Mean Sq F value  Pr(&gt;F)    
## sector      7   2572     367    17.8 &lt; 2e-16 ***
## sex         1    436     436    21.1 5.3e-06 ***
## exper       1    264     264    12.8 0.00037 ***
## Residuals 524  10805      21                    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
</code></pre>

<p>The mean square residual is about 20.</p>

<p>Now throw in some junk:</p>

<pre><code class="r">mod10 = lm(wage ~ sector + sex + exper + rand(10), data = CPS85)
anova(mod10)
</code></pre>

<pre><code>## Analysis of Variance Table
## 
## Response: wage
##            Df Sum Sq Mean Sq F value  Pr(&gt;F)    
## sector      7   2572     367   18.07 &lt; 2e-16 ***
## sex         1    436     436   21.45 4.6e-06 ***
## exper       1    264     264   13.01 0.00034 ***
## rand(10)   10    357      36    1.76 0.06578 .  
## Residuals 514  10448      20                    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
</code></pre>

<p>But what if a term eats more variance than a junky term.  That term makes it easier for the other terms to show significance.</p>

<p>EXAMPLE:  Difference in age between husband and wife in couples getting married.</p>

<p>Ask: Who is older in a married couple, the man or the woman?  By how much?  </p>

<p>Let&#39;s see if the data support this:</p>

<pre><code class="r">m = fetchData(&quot;marriage.csv&quot;)
</code></pre>

<pre><code>## Retrieving from http://www.mosaic-web.org/go/datasets/marriage.csv
</code></pre>

<pre><code class="r">mod0 = mm(Age ~ Person, data = m)
mod0
</code></pre>

<pre><code>## Groupwise Model.
## Call:
## Age ~ Person
## 
## Coefficients:
## Bride  Groom  
##  33.2   35.8
</code></pre>

<pre><code class="r">confint(mod0)
</code></pre>

<pre><code>##   group 2.5 % 97.5 %
## 1 Bride 29.15  37.33
## 2 Groom 31.70  39.87
</code></pre>

<pre><code class="r">mod1 = lm(Age ~ Person, data = m)
summary(mod1)
</code></pre>

<pre><code>## 
## Call:
## lm(formula = Age ~ Person, data = m)
## 
## Residuals:
##    Min     1Q Median     3Q    Max 
## -17.42 -12.02  -3.34   8.80  39.56 
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)    33.24       2.06   16.13   &lt;2e-16 ***
## PersonGroom     2.55       2.91    0.87     0.38    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1 
## 
## Residual standard error: 14.4 on 96 degrees of freedom
## Multiple R-squared: 0.00789, Adjusted R-squared: -0.00245 
## F-statistic: 0.763 on 1 and 96 DF,  p-value: 0.384
</code></pre>

<p>The point estimate is about right, but the margin of error is so large that we can&#39;t take this estimate very seriously.  The p-value is so large that we can&#39;t reject the null that there is no relationship between <code>Person</code> and age.</p>

<p>Try adding in some other variables, astrological sign, years of education, etc. and show that this doesn&#39;t help much.</p>

<p>Finally, add in the <code>BookpageID</code> variable.  </p>

<pre><code class="r">mod2 = lm(Age ~ Person + BookpageID, data = m)
anova(mod2)
</code></pre>

<pre><code>## Analysis of Variance Table
## 
## Response: Age
##            Df Sum Sq Mean Sq F value Pr(&gt;F)    
## Person      1    159     159    9.07 0.0041 ** 
## BookpageID 48  19127     398   22.77 &lt;2e-16 ***
## Residuals  48    840      18                   
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
</code></pre>

<pre><code class="r">head(confint(mod2))
</code></pre>

<pre><code>##                        2.5 % 97.5 %
## (Intercept)          18.7105 30.728
## PersonGroom           0.8461  4.245
## BookpageIDB230p1354  -9.1763  7.648
## BookpageIDB230p1665  -6.6544 10.169
## BookpageIDB230p1948 -13.7133  3.111
## BookpageIDB230p539   -3.7393 13.085
</code></pre>

<p>This gives an individual ID to each marriage.  Putting this in the model effectively holds the couple constant when considering the <code>Person</code>.  In terms of ANOVA, <code>BookpageID</code> is eating up lots and lots of variance.</p>

<h3>Meta-studies and funnel plots</h3>

<ul>
<li>The standard error and the funnel plot: looking at lots of studies and comparing their odds ratios and standard errors: Start at time 9:30 in <a href="http://www.ted.com/talks/ben_goldacre_battling_bad_science.html">this TED video</a> </li>
<li><a href="http://en.wikipedia.org/wiki/Funnel_plot">Wikipedia</a></li>
</ul>

</body>

</html>

